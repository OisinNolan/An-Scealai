<!-- Select the synthesis option for a story -->
<img src="assets/img/book.png" class="bookImg">
<div class="page">
  <div class="bookContainerSynth">
    <!--popup for update story option -->
    <div class="{{modalClass}} modalContainer">
        <div class="modalContent">
            <pre class="modalText">Are you sure you want to update to the most current version?</pre>
            <pre class="modalText">(This will reset current audio recording data)</pre>
            <div>
                <button class="modalBtn createBtnGreen" (click)="updateStory()">{{ts.l.yes}}</button>
                <button class="modalBtn createBtnGreen" (click)="hideModal()">{{ts.l.no}}</button>
            </div>
        </div>
    </div>
    <!-- back button to return to story and save button to send recordings to db-->
      <div class="recordingBookHeader" *ngIf="story">
        <div (click)="goToDashboard()" class="myStoriesBtn"><i class="fa fa-chevron-left"></i> {{ts.l.story}}</div> 
        <div></div>
        <div [ngClass]="recordingMode ? 'bookTitle': 'bookTitleHistory'">{{story?.title}}<span *ngIf="!recordingSaved">*</span></div>
        <div *ngIf="recordingMode" class="recordingSaveIcon">
          <div *ngIf="recordingSaved" class="recordingSavedIcon">
            {{ts.l.saved}} <i class="fas fa-check"></i>
          </div>
          <div *ngIf="!recordingSaved" class="recordingUnsavedIcon" (click)="saveRecordings()">
            {{ts.l.save}} <i class="fas fa-save"></i>
          </div>
        </div>
      </div>
      <div class="recordingStoryContainer" *ngIf="story">
        <div *ngIf="recordingMode" class="recordingStoryHeader">
          Listen, record, and compare
        </div>
        <div *ngIf="historyMode" class="recordingStoryHeader">
          View Pronunciation History
        </div>
        <div class="textFieldContainer">
          <div *ngIf="historyMode" class="historyToolbar">
            <div class="selectStoryFilter">
              <select  [(ngModel)]="recording" (ngModelChange)="displayPreviousRecording()">
                <option *ngFor="let item of recordingHistory" [ngValue]="item">{{item.date | date:'dd/MM/yyyy h:mm aa'}} -- {{item.storyData.dialect}}</option>
              </select>
            </div>
          </div>
          <!--Main container for story -->
            <div [ngClass]="recordingMode ? 'textContainerSynth': 'historyTextContainerSynth'">
              <!-- Display synthesising (loading) -->
              <div *ngIf="!audioFinishedLoading && !recordingsFinishedLoading" class="loaderContainer">
                  <b>{{ts.l.synthesising}}</b>
                  <div class="lds-grid"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
              </div>
              <!-- When synthesis finished loading -->
              <div *ngIf="audioFinishedLoading && recordingsFinishedLoading">
                <!-- loop through each paragraph of text -->
                  <div *ngFor="let p of paragraphs" class="paragraphContainer">
                    <!-- if paragraph option selected -->
                    <span *ngIf="sectionSplit==='paragraph'">
                      <!-- play / pause synthesiser -->
                      <span [innerHTML]="p.responseHtml" [attr.id]="'paragraph-' + p.index"></span>
                      <button *ngIf="p.audioPlaying" (click)="stopAudio(p)" class="playAudioBtn"><i class="fas fa-pause"></i></button>
                      <button *ngIf="!p.audioPlaying" (click)="playAudio(p)" class="playAudioBtn"><i class="fa fa-play"></i></button>
                      <!-- play / pause student recorded audio -->
                      <button *ngIf="showListenBackParagraph[p.index]" class="playAudioBtn" style="background-color:red" (click)="playbackAudio(p.index)"><i class="fas fa-play"></i></button>
                      <audio [hidden]="!newRecordingParagraph[p.index]" [attr.src]="paragraphAudioSources[p.index]" [attr.id]="'audioParagraph-' + p.index" controls #audioTag class="audioPlayer"></audio>
                      <div *ngIf="registrationError" class="errorMessage">{{errorText}}</div>
                      <!-- recording button -->
                      <button *ngIf="recordingMode && !isRecording" class="recordBtn notRecordingBtn" type="button" (click)="prepRecording(p.index)"></button>
                      <button [hidden]="recordingMode && !isRecording" [attr.id]="'p-' + p.index" class="recordBtn notRecordingBtn" (click)="stopRecording(p.index);" ></button>          
                    </span>
                    <!-- if sentence option selected -->
                    <span *ngIf="sectionSplit==='sentence'">
                      <!-- loop thorugh each sentence in the paragraph -->
                      <div *ngFor="let s of p.sentences" class="sentenceContainer">
                        <!-- play / pause synthesiser -->
                        <span [innerHTML]="s.responseHtml" [attr.id]="'sentence-' + s.index"></span>
                        <button *ngIf="s.audioPlaying" (click)="stopAudio(s)" class="playAudioBtn"><i class="fas fa-pause"></i></button>
                        <button *ngIf="!s.audioPlaying" (click)="playAudio(s)" class="playAudioBtn"><i class="fa fa-play"></i></button>
                        <!-- play / pause student audio -->
                        <button *ngIf="showListenBackSentence[s.index]" class="playAudioBtn" style="background-color:red" (click)="playbackAudio(s.index)"><i class="fas fa-play"></i></button>
                        <audio *ngIf="newRecordingSentence[s.index]" [attr.src]="sentenceAudioSources[s.index]" id="audio" controls #audioTag class="audioPlayer"></audio>
                        <div *ngIf="registrationError" class="errorMessage">{{errorText}}</div>
                        <!-- recording button -->
                        <button *ngIf="!isRecording && recordingMode" class="recordBtn notRecordingBtn" type="button" (click)="prepRecording(s.index)"></button>
                        <button [hidden]="!isRecording && recordingMode" [attr.id]="'s-' + s.index"class="recordBtn notRecordingBtn" (click)="stopRecording(s.index);"></button>          
                      </div>
                    </span>
                  </div>
              </div>
            </div>
            <!-- Choose paragraph or Sentence buttons -->
            <div *ngIf="audioFinishedLoading" class="footer">
              <div class="btnContainer">
                <div class="footerText">
                  {{ts.l.listen_by}}
                </div>
                <div *ngIf="sectionSplit==='paragraph'">
                  <button class="changeSplitBtn selectedBtn">{{ts.l.paragraph}}</button>
                  <button class="changeSplitBtn" (click)="sentenceMode()">{{ts.l.sentence}}</button>
                </div>
                <div *ngIf="sectionSplit==='sentence'">
                  <button class="changeSplitBtn" (click)="paragraphMode()">{{ts.l.paragraph}}</button>
                  <button class="changeSplitBtn selectedBtn">{{ts.l.sentence}}</button>
                </div>
                <div *ngIf="recordingMode" style="padding-left: 40px">
                  <button *ngIf="needsUpdating" class="changeSplitBtn" (click)="showModal()"> Update Story </button>
                  <button *ngIf="recordingHistory && recordingHistory.length > 0" class="changeSplitBtn" (click)="switchToHistoryMode()"> View History </button>
                </div>
                <div *ngIf="historyMode" style="padding-left: 40px">
                  <button class="changeSplitBtn" (click)="switchToRecordMode()"> Record Story </button>
                </div>
              </div>
            </div>
        </div>
      </div>
  </div>
</div>