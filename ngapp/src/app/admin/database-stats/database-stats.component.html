<div class="dashboard">
  <div class="dashboard-header">
    <h3 class="dashboard-title">Database Statistics</h3>
  </div>
  <div class="cards-container">
    <!-- User numbers -->
    <mat-card>
      <grid-spinner *ngIf="!userCounts"></grid-spinner>
      <mat-card-header class="stats-card-header">
        <mat-card-title *ngIf="dataLoaded"
          >Number of Users ({{ userCounts.total }})</mat-card-title
        >
      </mat-card-header>
      <mat-card-content>
        <canvas id="user-counts"> </canvas>
      </mat-card-content>
    </mat-card>
    <!-- User Stats -->
    <mat-card>
      <grid-spinner *ngIf="!dataLoaded"></grid-spinner>
      <div *ngIf="dataLoaded">
        <mat-card-header class="stats-card-header">
          <mat-card-title>User Stats</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Profiles filled out:</b>
              {{ profileFilledPercentage | percent : "2.2" }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Students with at least 1 story:</b>
              {{ studentsWithStoriesPercentage | percent : "2.2" }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Teaechers with at least 1 classroom:</b>
              {{ teachersWithClassroomsPercentage | percent : "2.2" }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Language Settings:</b>
              <div><b>GA:</b> {{ irishPercentage | percent : "2.2" }}</div>
              <div><b>EN:</b> {{ englishPercentage | percent : "2.2" }}</div>
            </mat-card-content>
          </mat-card>
        </mat-card-content>
      </div>
    </mat-card>
    <!-- County Chart-->
    <mat-card>
      <mat-card-header class="stats-card-header">
        <mat-card-title> Map of Users </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <canvas id="county-chart"></canvas>
      </mat-card-content>
    </mat-card>
    <!-- Story Stats -->
    <mat-card>
      <grid-spinner *ngIf="!storyStats"></grid-spinner>
      <div *ngIf="storyStats">
        <mat-card-header class="stats-card-header">
          <mat-card-title>Story Stats</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total words:</b> {{ storyStats.totalWords }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total stories:</b> {{ storyStats.totalStories }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Avg words per story:</b> {{ storyStats.avgWordCount }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total recordings:</b> {{ storyStats.totalRecordings }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total stories created with prompts:</b>
              {{ storyStats.createdWithPrompts }}
            </mat-card-content>
          </mat-card>
        </mat-card-content>
      </div>
    </mat-card>

    <!-- Feedback Stats (Old)-->
    <mat-card>
      <grid-spinner *ngIf="!storyStats"></grid-spinner>
      <div *ngIf="storyStats">
        <mat-card-header class="stats-card-header">
          <mat-card-title>Feedback Stats (2019 - July 2023)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total stories with feedback:</b> {{ storyStats.totalFeedback }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Stories with only textual feedback:</b>
              {{ storyStats.onlyTextFeedback }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Stories with only audio feedback:</b>
              {{ storyStats.onlyAudioFeedback }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Stories with both text/audio feedback:</b>
              {{ storyStats.bothAudioAndText }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total words textual feedback:</b>
              {{ storyStats.totalFeedbackWords }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Avg words textual feedback:</b>
              {{ storyStats.avgFeedbackWordCount }}
            </mat-card-content>
          </mat-card>
        </mat-card-content>
      </div>
    </mat-card>
    <!-- Feedback Stats (New)-->
    <mat-card>
      <grid-spinner *ngIf="!feedbackStats"></grid-spinner>
      <div *ngIf="feedbackStats">
        <mat-card-header class="stats-card-header">
          <mat-card-title>Feedback Stats (2023+)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total story with comments:</b> {{ storyStats.hasComments }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total feedback comments:</b>
              {{ feedbackStats.totalFeedbackComments }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Comments with only text:</b>
              {{ feedbackStats.feedbackCommentsJustText }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Comments with only audio:</b>
              {{ feedbackStats.feedbackCommentsJustAudio }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Comments with text and audio:</b>
              {{ feedbackStats.feedbackCommentsWithTextAndAudio }}
            </mat-card-content>
          </mat-card>
        </mat-card-content>
      </div>
    </mat-card>
    <!-- Teacher stats -->
    <mat-card>
      <grid-spinner *ngIf="!feedbackStats"></grid-spinner>
      <div *ngIf="feedbackStats">
        <mat-card-header class="stats-card-header">
          <mat-card-title>Teacher Stats</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Total classrooms:</b> {{ totalClassrooms }}
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content class="cardText">
              <b>Avg students per classroom:</b> {{ avgNumStudentsInClass }}
            </mat-card-content>
          </mat-card>
        </mat-card-content>
      </div>
    </mat-card>
    <!-- Grammar Pie Chart-->
    <!-- <mat-card>
      <mat-card-header class="stats-card-header">
        <mat-card-title> Grammar Errors </mat-card-title>
      </mat-card-header>
      <mat-card-content style="display: flex">
        <div class="legendContainer" *ngIf="pieChartLegendItems.length > 0">
          <div class="legend">Legend</div>
          <hr />
          <div *ngFor="let item of pieChartLegendItems">
            <div class="legendPair">
              <div
                class="legendMarker"
                [style.backgroundColor]="item.fillStyle"
                [style.borderColor]="item.strokeStyle"
              ></div>
              <div>{{ item.text }}</div>
            </div>
          </div>
        </div>
        <div class="pieContainer">
          <canvas id="grammar-pie-chart" width="200" height="200"></canvas>
        </div>
      </mat-card-content>
    </mat-card> -->
  </div>
</div>
