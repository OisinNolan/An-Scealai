/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as _ from 'lodash';
import { FileService } from './test';
import { Component, Input, forwardRef, ElementRef, Renderer } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
var UploadImagesComponent = /** @class */ (function () {
    function UploadImagesComponent(api, element, renderer) {
        this.api = api;
        this.element = element;
        this.renderer = renderer;
        this.inProgress = {
            process: false,
            error: false
        };
        this.number_file_upload_success = 0;
        this.onChange = function (val) { };
        this.onTouched = function () { };
        this.disabled = false;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    UploadImagesComponent.prototype.writeValue = /**
     * @param {?} val
     * @return {?}
     */
    function (val) {
        if (val) {
            this.value = val;
        }
    };
    Object.defineProperty(UploadImagesComponent.prototype, "value", {
        get: /**
         * @return {?}
         */
        function () {
            return this._value;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._value = val;
            this.onChange(this._value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} fn
     * @return {?}
     */
    UploadImagesComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    UploadImagesComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    UploadImagesComponent.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this.disabled = isDisabled;
    };
    /**
     * @return {?}
     */
    UploadImagesComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        var $this = this;
        if (!_.isUndefined(this.accept)) {
            this.valid_extensions = this.accept.split('|');
        }
        $('#uploadfile-reactive-form').click(function () {
            if (_this.inProgress[_this.subProgress] !== true) {
                // tslint:disable-next-line:prefer-const
                /** @type {?} */
                var input_1 = document.createElement('input');
                input_1.type = 'file';
                if (!_.isNil(_this.multiple) && _this.multiple === 'true') {
                    input_1.multiple = true;
                }
                $(input_1).trigger('click');
                $(input_1).on('change', function (event) {
                    _this.number_file_upload_success = 0;
                    _this.files = input_1.files;
                    if (_this.files.length > 1) {
                        _this.response_data = [];
                        _.forEach(_this.files, function (file) {
                            $this.validateFile(file);
                        });
                    }
                    if (_this.files.length === 1) {
                        _this.validateFile(_this.files[0]);
                    }
                });
            }
        });
    };
    /**
     * @param {?} file
     * @return {?}
     */
    UploadImagesComponent.prototype.getFileExtension = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        return file.name.split('.').pop();
    };
    /**
     * @param {?} file
     * @return {?}
     */
    UploadImagesComponent.prototype.validateFile = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        var _this = this;
        if (file !== undefined) {
            if (!_.isNil(this.allowMaxSize) && this.allowMaxSize !== '') {
                if (file.size > parseFloat(this.allowMaxSize) * 1024 * 1024) {
                    // this.notification.show('warning', `Please select file less than ${this.allowMaxSize}MB`, 5000);
                    console.log('Please select file less than');
                    return false;
                }
            }
            // tslint:disable-next-line:max-line-length
            if (!_.isUndefined(this.accept) && _.isUndefined(_.find(this.valid_extensions, function (item) { return item.toLowerCase() === _this.getFileExtension(file).toLowerCase(); }))) {
                // this.notification.show('warning', `Please select a file with valid type`, 5000);
                console.log('Please select a file with valid type');
                return false;
            }
            this.upload(file);
        }
    };
    /**
     * @param {?} file
     * @return {?}
     */
    UploadImagesComponent.prototype.upload = /**
     * @param {?} file
     * @return {?}
     */
    function (file) {
        var _this = this;
        /** @type {?} */
        var $this = this;
        this.inProgress[this.subProgress] = true;
        this.inProgress[this.subError] = false;
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        var params = {
            files: file
        };
        this.api.upload(params, this.apiUpload, this.headers).subscribe(function (response) {
            _this.inProgress[_this.subProgress] = false;
            _this.number_file_upload_success++;
            if (!_.isNil(_this.multiple) && _this.multiple === 'true') {
                _this.value.push(_this.resultTransformer(response));
            }
            else {
                _this.value = _this.resultTransformer(response);
            }
            console.log('value', _this.value);
        }, function (error) {
            _this.inProgress[_this.subProgress] = false;
            _this.inProgress[_this.subError] = true;
            console.log('error', error);
        });
    };
    /**
     * @param {?} item
     * @return {?}
     */
    UploadImagesComponent.prototype.deleteItem = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        this.value.splice(this.value.indexOf(item), 1);
        console.log('value', this.value);
    };
    UploadImagesComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line:component-selector
                    selector: 'upload-images',
                    template: "<div class=\"row\">\n  <div class=\"signle-img\" *ngIf=\"!multiple\">\n    <img [src]=\"value\" width=\"100\" height=\"100\" alt=\"\">\n  </div>\n  <div class=\"mutil-img\" *ngIf=\"multiple === 'true'\">\n    <div class=\"group-item\" *ngFor=\"let item of value\">\n      <img class=\"singleImg\" width=\"100\" height=\"100\" [src]=\"item\" alt=\"\">\n      <span (click)=\"deleteItem(item)\">Remove</span>\n    </div>\n  </div>\n  <img class=\"add-icon\" id=\"uploadfile-reactive-form\" width=\"100\" height=\"100\" src=\"https://mbtskoudsalg.com/images/how-to-add-a-png-to-a-photo.png\" alt=\"\">\n</div>\n",
                    providers: [
                        FileService,
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(function () { return UploadImagesComponent; }),
                            multi: true
                        }
                    ],
                    styles: [".row{margin-top:15px}.mutil-img .group-item .singleImg,.signle-img{border:1px solid grey;padding:3px}.mutil-img,.signle-img{margin-bottom:30px;display:inline-block}.mutil-img .group-item{display:inline-block;position:relative;margin-right:5px}.mutil-img .group-item span{position:absolute;left:50%;bottom:-15px;margin-left:-25px;cursor:pointer}.mutil-img .group-item span:hover{text-decoration:underline;color:grey}.add-icon{margin-left:30px;cursor:pointer}"]
                }] }
    ];
    UploadImagesComponent.ctorParameters = function () { return [
        { type: FileService },
        { type: ElementRef },
        { type: Renderer }
    ]; };
    UploadImagesComponent.propDecorators = {
        headers: [{ type: Input }],
        apiUpload: [{ type: Input }],
        accept: [{ type: Input }],
        subProgress: [{ type: Input }],
        subError: [{ type: Input }],
        allowMaxSize: [{ type: Input }],
        uploadPath: [{ type: Input }],
        multiple: [{ type: Input }],
        _value: [{ type: Input }],
        resultTransformer: [{ type: Input }],
        paramName: [{ type: Input }]
    };
    return UploadImagesComponent;
}());
export { UploadImagesComponent };
if (false) {
    /** @type {?} */
    UploadImagesComponent.prototype.headers;
    /** @type {?} */
    UploadImagesComponent.prototype.apiUpload;
    /** @type {?} */
    UploadImagesComponent.prototype.accept;
    /** @type {?} */
    UploadImagesComponent.prototype.inProgress;
    /** @type {?} */
    UploadImagesComponent.prototype.subProgress;
    /** @type {?} */
    UploadImagesComponent.prototype.subError;
    /** @type {?} */
    UploadImagesComponent.prototype.allowMaxSize;
    /** @type {?} */
    UploadImagesComponent.prototype.uploadPath;
    /** @type {?} */
    UploadImagesComponent.prototype.multiple;
    /** @type {?} */
    UploadImagesComponent.prototype._value;
    /** @type {?} */
    UploadImagesComponent.prototype.resultTransformer;
    /** @type {?} */
    UploadImagesComponent.prototype.paramName;
    /** @type {?} */
    UploadImagesComponent.prototype.files;
    /** @type {?} */
    UploadImagesComponent.prototype.number_file_upload_success;
    /** @type {?} */
    UploadImagesComponent.prototype.response_data;
    /** @type {?} */
    UploadImagesComponent.prototype.valid_extensions;
    /** @type {?} */
    UploadImagesComponent.prototype.disabled;
    /** @type {?} */
    UploadImagesComponent.prototype.onChange;
    /** @type {?} */
    UploadImagesComponent.prototype.onTouched;
    /** @type {?} */
    UploadImagesComponent.prototype.api;
    /** @type {?} */
    UploadImagesComponent.prototype.element;
    /** @type {?} */
    UploadImagesComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLWltYWdlcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXJlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy91cGxvYWQtaW1hZ2VzL3VwbG9hZC1pbWFnZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRXJDLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6RTtJQXFERSwrQkFBb0IsR0FBZ0IsRUFBVSxPQUFtQixFQUFVLFFBQWtCO1FBQXpFLFFBQUcsR0FBSCxHQUFHLENBQWE7UUFBVSxZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQWhDN0YsZUFBVSxHQUFRO1lBQ2hCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsS0FBSyxFQUFFLEtBQUs7U0FDYixDQUFDO1FBb0JGLCtCQUEwQixHQUFHLENBQUMsQ0FBQztRQVU3QixJQUFJLENBQUMsUUFBUSxHQUFHLFVBQUMsR0FBUSxJQUFNLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsU0FBUyxHQUFHLGNBQU8sQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7Ozs7O0lBRUQsMENBQVU7Ozs7SUFBVixVQUFXLEdBQVE7UUFDakIsSUFBSSxHQUFHLEVBQUU7WUFDUCxJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRCxzQkFBSSx3Q0FBSzs7OztRQUFUO1lBQ0UsT0FBTyxJQUFJLENBQUMs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ekIsNG1CQUE2QztvQkFFN0MsU0FBUyxFQUFFO3dCQUNULFdBQVc7d0JBQ1g7NEJBQ0UsT0FBTyxFQUFFLGlCQUFpQjs0QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxjQUFNLE9BQUEscUJBQXFCLEVBQXJCLENBQXFCLENBQUM7NEJBQ3BELEtBQUssRUFBRSxJQUFJO3lCQUNaO3FCQUNGOztpQkFDRjs7O2dCQWxCUSxXQUFXO2dCQUUyQixVQUFVO2dCQUFFLFFBQVE7OzswQkFrQmhFLEtBQUs7NEJBRUwsS0FBSzt5QkFFTCxLQUFLOzhCQU1MLEtBQUs7MkJBRUwsS0FBSzsrQkFFTCxLQUFLOzZCQUVMLEtBQUs7MkJBRUwsS0FBSzt5QkFHTCxLQUFLO29DQUVMLEtBQUs7NEJBRUwsS0FBSzs7SUF1SVIsNEJBQUM7Q0FBQSxBQS9LRCxJQStLQztTQWpLWSxxQkFBcUI7OztJQUNoQyx3Q0FDZ0I7O0lBQ2hCLDBDQUNrQjs7SUFDbEIsdUNBQ2U7O0lBQ2YsMkNBR0U7O0lBQ0YsNENBQ2lCOztJQUNqQix5Q0FDYzs7SUFDZCw2Q0FDa0I7O0lBQ2xCLDJDQUNnQjs7SUFDaEIseUNBQ2M7O0lBRWQsdUNBQ1k7O0lBQ1osa0RBQ2tCOztJQUNsQiwwQ0FDVTs7SUFFVixzQ0FBTTs7SUFDTiwyREFBK0I7O0lBQy9CLDhDQUFjOztJQUNkLGlEQUFpQjs7SUFHakIseUNBQTBCOztJQUMxQix5Q0FBMkI7O0lBQzNCLDBDQUE0Qjs7SUFFaEIsb0NBQXdCOztJQUFFLHdDQUEyQjs7SUFBRSx5Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBGaWxlU2VydmljZSB9IGZyb20gJy4vdGVzdCc7XG5kZWNsYXJlIGNvbnN0ICQ6IGFueTtcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgZm9yd2FyZFJlZiwgRWxlbWVudFJlZiwgUmVuZGVyZXIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ3VwbG9hZC1pbWFnZXMnLFxuICB0ZW1wbGF0ZVVybDogJy4vdXBsb2FkLWltYWdlcy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3VwbG9hZC1pbWFnZXMuY29tcG9uZW50LmNzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICBGaWxlU2VydmljZSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFVwbG9hZEltYWdlc0NvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBVcGxvYWRJbWFnZXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQElucHV0KClcbiAgaGVhZGVyczogc3RyaW5nO1xuICBASW5wdXQoKVxuICBhcGlVcGxvYWQ6IHN0cmluZztcbiAgQElucHV0KClcbiAgYWNjZXB0OiBzdHJpbmc7XG4gIGluUHJvZ3Jlc3M6IGFueSA9IHtcbiAgICBwcm9jZXNzOiBmYWxzZSxcbiAgICBlcnJvcjogZmFsc2VcbiAgfTtcbiAgQElucHV0KClcbiAgc3ViUHJvZ3Jlc3M6IGFueTtcbiAgQElucHV0KClcbiAgc3ViRXJyb3I6IGFueTtcbiAgQElucHV0KClcbiAgYWxsb3dNYXhTaXplOiBhbnk7XG4gIEBJbnB1dCgpXG4gIHVwbG9hZFBhdGg6IGFueTtcbiAgQElucHV0KClcbiAgbXVsdGlwbGU6IGFueTtcblxuICBASW5wdXQoKVxuICBfdmFsdWU6IGFueTtcbiAgQElucHV0KClcbiAgcmVzdWx0VHJhbnNmb3JtZXI7XG4gIEBJbnB1dCgpXG4gIHBhcmFtTmFtZTtcblxuICBmaWxlcztcbiAgbnVtYmVyX2ZpbGVfdXBsb2FkX3N1Y2Nlc3MgPSAwO1xuICByZXNwb25zZV9kYXRhO1xuICB2YWxpZF9leHRlbnNpb25zO1xuXG5cbiAgcHJpdmF0ZSBkaXNhYmxlZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBvbkNoYW5nZTogRnVuY3Rpb247XG4gIHByaXZhdGUgb25Ub3VjaGVkOiBGdW5jdGlvbjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwaTogRmlsZVNlcnZpY2UsIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIpIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gKHZhbDogYW55KSA9PiB7fTtcbiAgICB0aGlzLm9uVG91Y2hlZCA9ICgpID0+IHt9O1xuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodmFsKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdmFsO1xuICAgIH1cbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBzZXQgdmFsdWUodmFsKSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWw7XG4gICAgdGhpcy5vbkNoYW5nZSh0aGlzLl92YWx1ZSk7XG4gIH1cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcbiAgICBsZXQgJHRoaXMgPSB0aGlzO1xuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMuYWNjZXB0KSkge1xuICAgICAgdGhpcy52YWxpZF9leHRlbnNpb25zID0gdGhpcy5hY2NlcHQuc3BsaXQoJ3wnKTtcbiAgICB9XG5cbiAgICAkKCcjdXBsb2FkZmlsZS1yZWFjdGl2ZS1mb3JtJykuY2xpY2soKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaW5Qcm9ncmVzc1t0aGlzLnN1YlByb2dyZXNzXSAhPT0gdHJ1ZSkge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWNvbnN0XG4gICAgICAgIGxldCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIGlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIGlmICghXy5pc05pbCh0aGlzLm11bHRpcGxlKSAmJiB0aGlzLm11bHRpcGxlID09PSAndHJ1ZScpIHtcbiAgICAgICAgICBpbnB1dC5tdWx0aXBsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgJChpbnB1dCkudHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgJChpbnB1dCkub24oJ2NoYW5nZScsIGV2ZW50ID0+IHtcbiAgICAgICAgICB0aGlzLm51bWJlcl9maWxlX3VwbG9hZF9zdWNjZXNzID0gMDtcbiAgICAgICAgICB0aGlzLmZpbGVzID0gaW5wdXQuZmlsZXM7XG5cbiAgICAgICAgICBpZiAodGhpcy5maWxlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlX2RhdGEgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh0aGlzLmZpbGVzLCBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICR0aGlzLnZhbGlkYXRlRmlsZShmaWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5maWxlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVGaWxlKHRoaXMuZmlsZXNbMF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBnZXRGaWxlRXh0ZW5zaW9uKGZpbGUpIHtcbiAgICByZXR1cm4gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gIH1cblxuICB2YWxpZGF0ZUZpbGUoZmlsZSkge1xuICAgIGlmIChmaWxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICghXy5pc05pbCh0aGlzLmFsbG93TWF4U2l6ZSkgJiYgdGhpcy5hbGxvd01heFNpemUgIT09ICcnKSB7XG4gICAgICAgIGlmIChmaWxlLnNpemUgPiBwYXJzZUZsb2F0KHRoaXMuYWxsb3dNYXhTaXplKSAqIDEwMjQgKiAxMDI0KSB7XG4gICAgICAgICAgLy8gdGhpcy5ub3RpZmljYXRpb24uc2hvdygnd2FybmluZycsIGBQbGVhc2Ugc2VsZWN0IGZpbGUgbGVzcyB0aGFuICR7dGhpcy5hbGxvd01heFNpemV9TUJgLCA1MDAwKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUGxlYXNlIHNlbGVjdCBmaWxlIGxlc3MgdGhhbicpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMuYWNjZXB0KSAmJiBfLmlzVW5kZWZpbmVkKF8uZmluZCh0aGlzLnZhbGlkX2V4dGVuc2lvbnMsIGl0ZW0gPT4gaXRlbS50b0xvd2VyQ2FzZSgpID09PSB0aGlzLmdldEZpbGVFeHRlbnNpb24oZmlsZSkudG9Mb3dlckNhc2UoKSkpKSB7XG4gICAgICAgIC8vIHRoaXMubm90aWZpY2F0aW9uLnNob3coJ3dhcm5pbmcnLCBgUGxlYXNlIHNlbGVjdCBhIGZpbGUgd2l0aCB2YWxpZCB0eXBlYCwgNTAwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQbGVhc2Ugc2VsZWN0IGEgZmlsZSB3aXRoIHZhbGlkIHR5cGUnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy51cGxvYWQoZmlsZSk7XG4gICAgfVxuICB9XG5cbiAgdXBsb2FkKGZpbGUpIHtcbiAgICBjb25zdCAkdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gdHJ1ZTtcbiAgICB0aGlzLmluUHJvZ3Jlc3NbdGhpcy5zdWJFcnJvcl0gPSBmYWxzZTtcblxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcbiAgICBsZXQgcGFyYW1zID0ge1xuICAgICAgZmlsZXM6IGZpbGVcbiAgICB9O1xuICAgIHRoaXMuYXBpLnVwbG9hZChwYXJhbXMsIHRoaXMuYXBpVXBsb2FkLCB0aGlzLmhlYWRlcnMpLnN1YnNjcmliZShcbiAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gZmFsc2U7XG4gICAgICAgIHRoaXMubnVtYmVyX2ZpbGVfdXBsb2FkX3N1Y2Nlc3MrKztcbiAgICAgICAgaWYgKCFfLmlzTmlsKHRoaXMubXVsdGlwbGUpICYmIHRoaXMubXVsdGlwbGUgPT09ICd0cnVlJykge1xuICAgICAgICAgIHRoaXMudmFsdWUucHVzaCh0aGlzLnJlc3VsdFRyYW5zZm9ybWVyKHJlc3BvbnNlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMucmVzdWx0VHJhbnNmb3JtZXIocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCd2YWx1ZScsIHRoaXMudmFsdWUpO1xuICAgICAgfSxcbiAgICAgIGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5Qcm9ncmVzc1t0aGlzLnN1YkVycm9yXSA9IHRydWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgZGVsZXRlSXRlbShpdGVtKSB7XG4gICAgdGhpcy52YWx1ZS5zcGxpY2UodGhpcy52YWx1ZS5pbmRleE9mKGl0ZW0pLCAxKTtcbiAgICBjb25zb2xlLmxvZygndmFsdWUnLCB0aGlzLnZhbHVlKTtcbiAgfVxufVxuIl19