/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import * as _ from 'lodash';
import { FileService } from './test';
import { Component, Input, forwardRef, ElementRef, Renderer } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
export class UploadImagesComponent {
    /**
     * @param {?} api
     * @param {?} element
     * @param {?} renderer
     */
    constructor(api, element, renderer) {
        this.api = api;
        this.element = element;
        this.renderer = renderer;
        this.inProgress = {
            process: false,
            error: false
        };
        this.number_file_upload_success = 0;
        this.onChange = (val) => { };
        this.onTouched = () => { };
        this.disabled = false;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    writeValue(val) {
        if (val) {
            this.value = val;
        }
    }
    /**
     * @return {?}
     */
    get value() {
        return this._value;
    }
    /**
     * @param {?} val
     * @return {?}
     */
    set value(val) {
        this._value = val;
        this.onChange(this._value);
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.onChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouched = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        let $this = this;
        if (!_.isUndefined(this.accept)) {
            this.valid_extensions = this.accept.split('|');
        }
        $('#uploadfile-reactive-form').click(() => {
            if (this.inProgress[this.subProgress] !== true) {
                // tslint:disable-next-line:prefer-const
                /** @type {?} */
                let input = document.createElement('input');
                input.type = 'file';
                if (!_.isNil(this.multiple) && this.multiple === 'true') {
                    input.multiple = true;
                }
                $(input).trigger('click');
                $(input).on('change', event => {
                    this.number_file_upload_success = 0;
                    this.files = input.files;
                    if (this.files.length > 1) {
                        this.response_data = [];
                        _.forEach(this.files, function (file) {
                            $this.validateFile(file);
                        });
                    }
                    if (this.files.length === 1) {
                        this.validateFile(this.files[0]);
                    }
                });
            }
        });
    }
    /**
     * @param {?} file
     * @return {?}
     */
    getFileExtension(file) {
        return file.name.split('.').pop();
    }
    /**
     * @param {?} file
     * @return {?}
     */
    validateFile(file) {
        if (file !== undefined) {
            if (!_.isNil(this.allowMaxSize) && this.allowMaxSize !== '') {
                if (file.size > parseFloat(this.allowMaxSize) * 1024 * 1024) {
                    // this.notification.show('warning', `Please select file less than ${this.allowMaxSize}MB`, 5000);
                    console.log('Please select file less than');
                    return false;
                }
            }
            // tslint:disable-next-line:max-line-length
            if (!_.isUndefined(this.accept) && _.isUndefined(_.find(this.valid_extensions, item => item.toLowerCase() === this.getFileExtension(file).toLowerCase()))) {
                // this.notification.show('warning', `Please select a file with valid type`, 5000);
                console.log('Please select a file with valid type');
                return false;
            }
            this.upload(file);
        }
    }
    /**
     * @param {?} file
     * @return {?}
     */
    upload(file) {
        /** @type {?} */
        const $this = this;
        this.inProgress[this.subProgress] = true;
        this.inProgress[this.subError] = false;
        // tslint:disable-next-line:prefer-const
        /** @type {?} */
        let params = {
            files: file
        };
        this.api.upload(params, this.apiUpload, this.headers).subscribe(response => {
            this.inProgress[this.subProgress] = false;
            this.number_file_upload_success++;
            if (!_.isNil(this.multiple) && this.multiple === 'true') {
                this.value.push(this.resultTransformer(response));
            }
            else {
                this.value = this.resultTransformer(response);
            }
            console.log('value', this.value);
        }, error => {
            this.inProgress[this.subProgress] = false;
            this.inProgress[this.subError] = true;
            console.log('error', error);
        });
    }
    /**
     * @param {?} item
     * @return {?}
     */
    deleteItem(item) {
        this.value.splice(this.value.indexOf(item), 1);
        console.log('value', this.value);
    }
}
UploadImagesComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'upload-images',
                template: "<div class=\"row\">\n  <div class=\"signle-img\" *ngIf=\"!multiple\">\n    <img [src]=\"value\" width=\"100\" height=\"100\" alt=\"\">\n  </div>\n  <div class=\"mutil-img\" *ngIf=\"multiple === 'true'\">\n    <div class=\"group-item\" *ngFor=\"let item of value\">\n      <img class=\"singleImg\" width=\"100\" height=\"100\" [src]=\"item\" alt=\"\">\n      <span (click)=\"deleteItem(item)\">Remove</span>\n    </div>\n  </div>\n  <img class=\"add-icon\" id=\"uploadfile-reactive-form\" width=\"100\" height=\"100\" src=\"https://mbtskoudsalg.com/images/how-to-add-a-png-to-a-photo.png\" alt=\"\">\n</div>\n",
                providers: [
                    FileService,
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => UploadImagesComponent),
                        multi: true
                    }
                ],
                styles: [".row{margin-top:15px}.mutil-img .group-item .singleImg,.signle-img{border:1px solid grey;padding:3px}.mutil-img,.signle-img{margin-bottom:30px;display:inline-block}.mutil-img .group-item{display:inline-block;position:relative;margin-right:5px}.mutil-img .group-item span{position:absolute;left:50%;bottom:-15px;margin-left:-25px;cursor:pointer}.mutil-img .group-item span:hover{text-decoration:underline;color:grey}.add-icon{margin-left:30px;cursor:pointer}"]
            }] }
];
UploadImagesComponent.ctorParameters = () => [
    { type: FileService },
    { type: ElementRef },
    { type: Renderer }
];
UploadImagesComponent.propDecorators = {
    headers: [{ type: Input }],
    apiUpload: [{ type: Input }],
    accept: [{ type: Input }],
    subProgress: [{ type: Input }],
    subError: [{ type: Input }],
    allowMaxSize: [{ type: Input }],
    uploadPath: [{ type: Input }],
    multiple: [{ type: Input }],
    _value: [{ type: Input }],
    resultTransformer: [{ type: Input }],
    paramName: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    UploadImagesComponent.prototype.headers;
    /** @type {?} */
    UploadImagesComponent.prototype.apiUpload;
    /** @type {?} */
    UploadImagesComponent.prototype.accept;
    /** @type {?} */
    UploadImagesComponent.prototype.inProgress;
    /** @type {?} */
    UploadImagesComponent.prototype.subProgress;
    /** @type {?} */
    UploadImagesComponent.prototype.subError;
    /** @type {?} */
    UploadImagesComponent.prototype.allowMaxSize;
    /** @type {?} */
    UploadImagesComponent.prototype.uploadPath;
    /** @type {?} */
    UploadImagesComponent.prototype.multiple;
    /** @type {?} */
    UploadImagesComponent.prototype._value;
    /** @type {?} */
    UploadImagesComponent.prototype.resultTransformer;
    /** @type {?} */
    UploadImagesComponent.prototype.paramName;
    /** @type {?} */
    UploadImagesComponent.prototype.files;
    /** @type {?} */
    UploadImagesComponent.prototype.number_file_upload_success;
    /** @type {?} */
    UploadImagesComponent.prototype.response_data;
    /** @type {?} */
    UploadImagesComponent.prototype.valid_extensions;
    /** @type {?} */
    UploadImagesComponent.prototype.disabled;
    /** @type {?} */
    UploadImagesComponent.prototype.onChange;
    /** @type {?} */
    UploadImagesComponent.prototype.onTouched;
    /** @type {?} */
    UploadImagesComponent.prototype.api;
    /** @type {?} */
    UploadImagesComponent.prototype.element;
    /** @type {?} */
    UploadImagesComponent.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLWltYWdlcy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXJlYWN0aXZlLWZvcm0vIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy91cGxvYWQtaW1hZ2VzL3VwbG9hZC1pbWFnZXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBRXJDLE9BQU8sRUFBRSxTQUFTLEVBQVUsS0FBSyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ3RHLE9BQU8sRUFBd0IsaUJBQWlCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQWdCekUsTUFBTTs7Ozs7O0lBdUNKLFlBQW9CLEdBQWdCLEVBQVUsT0FBbUIsRUFBVSxRQUFrQjtRQUF6RSxRQUFHLEdBQUgsR0FBRyxDQUFhO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFVLGFBQVEsR0FBUixRQUFRLENBQVU7UUFoQzdGLGVBQVUsR0FBUTtZQUNoQixPQUFPLEVBQUUsS0FBSztZQUNkLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FBQztRQW9CRiwrQkFBMEIsR0FBRyxDQUFDLENBQUM7UUFVN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFLEdBQUUsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7Ozs7O0lBRUQsVUFBVSxDQUFDLEdBQVE7UUFDakIsSUFBSSxHQUFHLEVBQUU7WUFDUCxJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQztTQUNsQjtJQUNILENBQUM7Ozs7SUFFRCxJQUFJLEtBQUs7UUFDUCxP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VUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHFCQUFxQixDQUFDO3dCQUNwRCxLQUFLLEVBQUUsSUFBSTtxQkFDWjtpQkFDRjs7YUFDRjs7O1lBbEJRLFdBQVc7WUFFMkIsVUFBVTtZQUFFLFFBQVE7OztzQkFrQmhFLEtBQUs7d0JBRUwsS0FBSztxQkFFTCxLQUFLOzBCQU1MLEtBQUs7dUJBRUwsS0FBSzsyQkFFTCxLQUFLO3lCQUVMLEtBQUs7dUJBRUwsS0FBSztxQkFHTCxLQUFLO2dDQUVMLEtBQUs7d0JBRUwsS0FBSzs7OztJQXpCTix3Q0FDZ0I7O0lBQ2hCLDBDQUNrQjs7SUFDbEIsdUNBQ2U7O0lBQ2YsMkNBR0U7O0lBQ0YsNENBQ2lCOztJQUNqQix5Q0FDYzs7SUFDZCw2Q0FDa0I7O0lBQ2xCLDJDQUNnQjs7SUFDaEIseUNBQ2M7O0lBRWQsdUNBQ1k7O0lBQ1osa0RBQ2tCOztJQUNsQiwwQ0FDVTs7SUFFVixzQ0FBTTs7SUFDTiwyREFBK0I7O0lBQy9CLDhDQUFjOztJQUNkLGlEQUFpQjs7SUFHakIseUNBQTBCOztJQUMxQix5Q0FBMkI7O0lBQzNCLDBDQUE0Qjs7SUFFaEIsb0NBQXdCOztJQUFFLHdDQUEyQjs7SUFBRSx5Q0FBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBGaWxlU2VydmljZSB9IGZyb20gJy4vdGVzdCc7XG5kZWNsYXJlIGNvbnN0ICQ6IGFueTtcbmltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgZm9yd2FyZFJlZiwgRWxlbWVudFJlZiwgUmVuZGVyZXIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ3VwbG9hZC1pbWFnZXMnLFxuICB0ZW1wbGF0ZVVybDogJy4vdXBsb2FkLWltYWdlcy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3VwbG9hZC1pbWFnZXMuY29tcG9uZW50LmNzcyddLFxuICBwcm92aWRlcnM6IFtcbiAgICBGaWxlU2VydmljZSxcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFVwbG9hZEltYWdlc0NvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBVcGxvYWRJbWFnZXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQElucHV0KClcbiAgaGVhZGVyczogc3RyaW5nO1xuICBASW5wdXQoKVxuICBhcGlVcGxvYWQ6IHN0cmluZztcbiAgQElucHV0KClcbiAgYWNjZXB0OiBzdHJpbmc7XG4gIGluUHJvZ3Jlc3M6IGFueSA9IHtcbiAgICBwcm9jZXNzOiBmYWxzZSxcbiAgICBlcnJvcjogZmFsc2VcbiAgfTtcbiAgQElucHV0KClcbiAgc3ViUHJvZ3Jlc3M6IGFueTtcbiAgQElucHV0KClcbiAgc3ViRXJyb3I6IGFueTtcbiAgQElucHV0KClcbiAgYWxsb3dNYXhTaXplOiBhbnk7XG4gIEBJbnB1dCgpXG4gIHVwbG9hZFBhdGg6IGFueTtcbiAgQElucHV0KClcbiAgbXVsdGlwbGU6IGFueTtcblxuICBASW5wdXQoKVxuICBfdmFsdWU6IGFueTtcbiAgQElucHV0KClcbiAgcmVzdWx0VHJhbnNmb3JtZXI7XG4gIEBJbnB1dCgpXG4gIHBhcmFtTmFtZTtcblxuICBmaWxlcztcbiAgbnVtYmVyX2ZpbGVfdXBsb2FkX3N1Y2Nlc3MgPSAwO1xuICByZXNwb25zZV9kYXRhO1xuICB2YWxpZF9leHRlbnNpb25zO1xuXG5cbiAgcHJpdmF0ZSBkaXNhYmxlZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBvbkNoYW5nZTogRnVuY3Rpb247XG4gIHByaXZhdGUgb25Ub3VjaGVkOiBGdW5jdGlvbjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFwaTogRmlsZVNlcnZpY2UsIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZiwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIpIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gKHZhbDogYW55KSA9PiB7fTtcbiAgICB0aGlzLm9uVG91Y2hlZCA9ICgpID0+IHt9O1xuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHdyaXRlVmFsdWUodmFsOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodmFsKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdmFsO1xuICAgIH1cbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWU7XG4gIH1cblxuICBzZXQgdmFsdWUodmFsKSB7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWw7XG4gICAgdGhpcy5vbkNoYW5nZSh0aGlzLl92YWx1ZSk7XG4gIH1cbiAgcmVnaXN0ZXJPbkNoYW5nZShmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcbiAgICBsZXQgJHRoaXMgPSB0aGlzO1xuXG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMuYWNjZXB0KSkge1xuICAgICAgdGhpcy52YWxpZF9leHRlbnNpb25zID0gdGhpcy5hY2NlcHQuc3BsaXQoJ3wnKTtcbiAgICB9XG5cbiAgICAkKCcjdXBsb2FkZmlsZS1yZWFjdGl2ZS1mb3JtJykuY2xpY2soKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuaW5Qcm9ncmVzc1t0aGlzLnN1YlByb2dyZXNzXSAhPT0gdHJ1ZSkge1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6cHJlZmVyLWNvbnN0XG4gICAgICAgIGxldCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIGlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIGlmICghXy5pc05pbCh0aGlzLm11bHRpcGxlKSAmJiB0aGlzLm11bHRpcGxlID09PSAndHJ1ZScpIHtcbiAgICAgICAgICBpbnB1dC5tdWx0aXBsZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgJChpbnB1dCkudHJpZ2dlcignY2xpY2snKTtcbiAgICAgICAgJChpbnB1dCkub24oJ2NoYW5nZScsIGV2ZW50ID0+IHtcbiAgICAgICAgICB0aGlzLm51bWJlcl9maWxlX3VwbG9hZF9zdWNjZXNzID0gMDtcbiAgICAgICAgICB0aGlzLmZpbGVzID0gaW5wdXQuZmlsZXM7XG5cbiAgICAgICAgICBpZiAodGhpcy5maWxlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlX2RhdGEgPSBbXTtcbiAgICAgICAgICAgIF8uZm9yRWFjaCh0aGlzLmZpbGVzLCBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICR0aGlzLnZhbGlkYXRlRmlsZShmaWxlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5maWxlcy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVGaWxlKHRoaXMuZmlsZXNbMF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBnZXRGaWxlRXh0ZW5zaW9uKGZpbGUpIHtcbiAgICByZXR1cm4gZmlsZS5uYW1lLnNwbGl0KCcuJykucG9wKCk7XG4gIH1cblxuICB2YWxpZGF0ZUZpbGUoZmlsZSkge1xuICAgIGlmIChmaWxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmICghXy5pc05pbCh0aGlzLmFsbG93TWF4U2l6ZSkgJiYgdGhpcy5hbGxvd01heFNpemUgIT09ICcnKSB7XG4gICAgICAgIGlmIChmaWxlLnNpemUgPiBwYXJzZUZsb2F0KHRoaXMuYWxsb3dNYXhTaXplKSAqIDEwMjQgKiAxMDI0KSB7XG4gICAgICAgICAgLy8gdGhpcy5ub3RpZmljYXRpb24uc2hvdygnd2FybmluZycsIGBQbGVhc2Ugc2VsZWN0IGZpbGUgbGVzcyB0aGFuICR7dGhpcy5hbGxvd01heFNpemV9TUJgLCA1MDAwKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnUGxlYXNlIHNlbGVjdCBmaWxlIGxlc3MgdGhhbicpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHRoaXMuYWNjZXB0KSAmJiBfLmlzVW5kZWZpbmVkKF8uZmluZCh0aGlzLnZhbGlkX2V4dGVuc2lvbnMsIGl0ZW0gPT4gaXRlbS50b0xvd2VyQ2FzZSgpID09PSB0aGlzLmdldEZpbGVFeHRlbnNpb24oZmlsZSkudG9Mb3dlckNhc2UoKSkpKSB7XG4gICAgICAgIC8vIHRoaXMubm90aWZpY2F0aW9uLnNob3coJ3dhcm5pbmcnLCBgUGxlYXNlIHNlbGVjdCBhIGZpbGUgd2l0aCB2YWxpZCB0eXBlYCwgNTAwMCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQbGVhc2Ugc2VsZWN0IGEgZmlsZSB3aXRoIHZhbGlkIHR5cGUnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy51cGxvYWQoZmlsZSk7XG4gICAgfVxuICB9XG5cbiAgdXBsb2FkKGZpbGUpIHtcbiAgICBjb25zdCAkdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gdHJ1ZTtcbiAgICB0aGlzLmluUHJvZ3Jlc3NbdGhpcy5zdWJFcnJvcl0gPSBmYWxzZTtcblxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpwcmVmZXItY29uc3RcbiAgICBsZXQgcGFyYW1zID0ge1xuICAgICAgZmlsZXM6IGZpbGVcbiAgICB9O1xuICAgIHRoaXMuYXBpLnVwbG9hZChwYXJhbXMsIHRoaXMuYXBpVXBsb2FkLCB0aGlzLmhlYWRlcnMpLnN1YnNjcmliZShcbiAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gZmFsc2U7XG4gICAgICAgIHRoaXMubnVtYmVyX2ZpbGVfdXBsb2FkX3N1Y2Nlc3MrKztcbiAgICAgICAgaWYgKCFfLmlzTmlsKHRoaXMubXVsdGlwbGUpICYmIHRoaXMubXVsdGlwbGUgPT09ICd0cnVlJykge1xuICAgICAgICAgIHRoaXMudmFsdWUucHVzaCh0aGlzLnJlc3VsdFRyYW5zZm9ybWVyKHJlc3BvbnNlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMucmVzdWx0VHJhbnNmb3JtZXIocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCd2YWx1ZScsIHRoaXMudmFsdWUpO1xuICAgICAgfSxcbiAgICAgIGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5pblByb2dyZXNzW3RoaXMuc3ViUHJvZ3Jlc3NdID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5Qcm9ncmVzc1t0aGlzLnN1YkVycm9yXSA9IHRydWU7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicsIGVycm9yKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgZGVsZXRlSXRlbShpdGVtKSB7XG4gICAgdGhpcy52YWx1ZS5zcGxpY2UodGhpcy52YWx1ZS5pbmRleE9mKGl0ZW0pLCAxKTtcbiAgICBjb25zb2xlLmxvZygndmFsdWUnLCB0aGlzLnZhbHVlKTtcbiAgfVxufVxuIl19